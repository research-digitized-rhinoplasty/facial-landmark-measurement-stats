<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Tabulator Multi-Select Header Filters</title>

  <!-- Tabulator CSS -->
  <link href="https://unpkg.com/tabulator-tables@5.5.0/dist/css/tabulator.min.css" rel="stylesheet" />

  <!-- Choices.js CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }

    .choices {
      margin: 0;
    }

    .choices__inner {
      font-size: 12px;
      min-height: auto;
      padding: 4px 8px;
    }

    .choices__list--multiple .choices__item {
      font-size: 11px;
    }

    .tabulator-header-filter input,
    .tabulator-header-filter select {
      width: 100%;
      box-sizing: border-box;
    }
  </style>
</head>
<body>

  <h2>Facial Stats Table with Embedded Filters</h2>

  <div id="table"></div>

  <!-- Tabulator JS -->
  <script src="https://unpkg.com/tabulator-tables@5.5.0/dist/js/tabulator.min.js"></script>

  <!-- Choices.js -->
  <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>

  <script>
    const tableData = [
      { id: 1, Name: "Alice", Gender: "F", Ethnicity: "Hispanic", "Facial Surgery": "None" },
      { id: 2, Name: "Bob", Gender: "M", Ethnicity: "Asian", "Facial Surgery": "Rhinoplasty" },
      { id: 3, Name: "Carlos", Gender: "M", Ethnicity: "Hispanic", "Facial Surgery": "None" },
      { id: 4, Name: "Diana", Gender: "F", Ethnicity: "Caucasian", "Facial Surgery": "Jaw Surgery" },
      { id: 5, Name: "Elena", Gender: "F", Ethnicity: "Asian", "Facial Surgery": "None" },
    ];

    function customMultiSelectFilter(field) {
      return function(cell, onRendered, success, cancel) {
        const input = document.createElement("select");
        input.setAttribute("multiple", true);

        const values = [...new Set(cell.getTable().getData().map(row => row[field]))];
        values.forEach(val => {
          const option = document.createElement("option");
          option.value = val;
          option.textContent = val;
          input.appendChild(option);
        });

        const choices = new Choices(input, {
          removeItemButton: true,
          shouldSort: false,
        });

        input.addEventListener("change", function () {
          const selected = choices.getValue(true);
          if (selected.length > 0) {
            success(function(cellValue) {
              return selected.includes(cellValue);
            });
          } else {
            success(); // Clear filter if nothing selected
          }
        });

        return input;
      };
    }

    const table = new Tabulator("#table", {
      height: 400,
      layout: "fitColumns",
      data: tableData,
      columns: [
        { title: "ID", field: "id", width: 60 },
        { title: "Name", field: "Name" },
        {
          title: "Gender",
          field: "Gender",
          headerFilter: customMultiSelectFilter("Gender")
        },
        {
          title: "Ethnicity",
          field: "Ethnicity",
          headerFilter: customMultiSelectFilter("Ethnicity")
        },
        {
          title: "Facial Surgery",
          field: "Facial Surgery",
          headerFilter: customMultiSelectFilter("Facial Surgery")
        },
      ],
    });
  </script>

</body>
</html>
