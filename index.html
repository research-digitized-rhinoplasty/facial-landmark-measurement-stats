<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Measurements Filter Example</title>
  <link href="https://unpkg.com/tabulator-tables@5.5.2/dist/css/tabulator.min.css" rel="stylesheet" />
  <script src="https://unpkg.com/tabulator-tables@5.5.2/dist/js/tabulator.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }

    .tabulator-header-filter select[multiple] {
      height: auto;
      max-height: 150px;
      overflow-y: auto;
    }
  </style>
</head>
<body>

  <h2>Second Table: Measurements</h2>
  <div id="measurements-table"></div>

  <script>
    const measurementOptions = [
      "(Inner) Intercanthal Distance/Width", "Ala/Alar Length (left)", "Ala/Alar Length (right)", "Alar Base Width", "Base Bony Width",
      "Columella Length", "Columella Width", "Distance between sill-base junction and alar flare", "Distance between 1st point - 2nd point",
      "Eye/palpebral fissure length - left", "Eye/palpebral fissure length - right", "Face Width", "Infratip Lobule Length", "Interalar Distance",
      "Lower Facial Height", "Mid-Facial Height", "Nasal Bridge Length", "Nasal Root Width", "Nasal Tip Projection", "Nose Height",
      "Nostril Floor Width (left)", "Nostril Floor Width (right)", "Outer Intercanthal Distance", "Premaxilla - left", "Premaxilla - right",
      "Radix Projection", "Subnasal Width", "Supratip Lobule", "Tip/Lobule Width", "Upper Facial Height",
      "Distances - Surface", "(Inner) Intercanthal Distance/Width - Surface", "Ala/Alar Length (left) - Surface", "Ala/Alar Length (right) - Surface",
      "Alar Base Width - Surface", "Base Bony Width - Surface", "Columella Length - Surface", "Columella Width - Surface",
      "Distance between sill-base junction and alar flare - Surface", "Distance between 1st point - 2nd point - Surface",
      "Eye/palpebral fissure length - left - Surface", "Eye/palpebral fissure length - right - Surface", "Face Width - Surface",
      "Infratip Lobule Length - Surface", "Interalar Distance - Surface", "Lower Facial Height - Surface", "Mid-Facial Height - Surface",
      "Nasal Bridge Length - Surface", "Nasal Root Width - Surface", "Nasal Tip Projection - Surface", "Nose Height - Surface",
      "Nostril Floor Width (left) - Surface", "Nostril Floor Width (right) - Surface", "Outer Intercanthal Distance - Surface",
      "Premaxilla - left - Surface", "Premaxilla - right - Surface", "Radix Projection - Surface", "Subnasal Width - Surface",
      "Supratip Lobule - Surface", "Tip/Lobule Width - Surface", "Upper Facial Height - Surface",
      "Angles", "Columellar Labial Angle", "Columellar Lobular Angle", "Degree of Deviation (I-type)", "Domal divergence",
      "Interalar Angle", "Medium facial third angle - right", "Nasal Tip Angle", "Nasofacial Angle", "Nasofrontal Angle", "Nasolabial Angle I",
      "Nasolabial contour", "Nasomental Angle I", "Rhinion deviation angle", "Supratip Deviation Angle", "Tip deviation angle",
      "Ratios", "Ratio: Symmetry - Alar Base (Right) to Nasion to Alar Base (Left)", "Ratio: Symmetry - Alar Base (Right) to Pronasale to Alar Base (Left)",
      "Ratio: Symmetry - Alar Base (Right) to Subnasale to Alar Base (Left)", "Lobule - Base Ratio", "Nasal Tip Projection: Baum",
      "Nasal Tip Projection: Byrd and Hobar", "Nasal Tip Projection: Goode", "Nasal Tip Projection: Goode (Left)",
      "Nasal Tip Projection: Goode (Right)", "Nasal Tip Projection: Powell and Humphries", "Nasal Tip Projection: Simons",
      "Nasal Width-Length Ratio", "Nasal Width–Intercanthal Distance Ratio", "Ratio: Nasion to Labiale Superios to Alar Base (Left)",
      "Ratio: Nasion to Labiale Superios to Alar Base (Right)", "Ratio: Nasion to Labiale Superios to Alar Rim’s Highest Point (left)",
      "Ratio: Nasion to Labiale Superios to Alar Rim’s Highest Point (right)", "Ratio: Nasion to Subnasale to Alar Base (Left)",
      "Ratio: Nasion to Subnasale to Alar Base (Right)", "Ratio: Nasion to Subnasale to Alar Rim’s Highest Point (left)",
      "Ratio: Nasion to Subnasale to Alar Rim’s Highest Point (right)",
      "Areas - Surface", "Alar Base Area", "Dorsal Hump Area", "Area of Entire Nose", "Nasal Dorsum Area", "Root of the Nose Area",
      "Tip Surface Area", "Area between the vertical fifths and horizontal thirds",
      "Volumes", "Alar Base Volume", "Dorsal Hump Volume", "Volume of Entire Nose", "Nasal Dorsum Volume", "Root of the Nose Volume",
      "Tip Volume", "Volume between the vertical fifths and horizontal thirds"
    ];

    // Custom header filter function using multiple select
    function multiSelectHeaderFilter(cell, onRendered, success, cancel, editorParams) {
      const select = document.createElement("select");
      select.setAttribute("multiple", "multiple");
      select.style.width = "100%";
      select.style.maxHeight = "120px";
      select.style.overflowY = "auto";

      measurementOptions.forEach(optionText => {
        const option = document.createElement("option");
        option.value = optionText;
        option.textContent = optionText;
        select.appendChild(option);
      });

      select.addEventListener("change", () => {
        const selected = Array.from(select.selectedOptions).map(opt => opt.value);
        success(selected.length ? selected : null);
      });

      return select;
    }

    function multiSelectFilterFunc(headerValue, rowValue, rowData, filterParams) {
      if (!headerValue || !Array.isArray(headerValue)) return true;
      return headerValue.includes(rowValue);
    }

    // Sample data
    const data = [
      { measurement: "Face Width", value: 128 },
      { measurement: "Nasal Tip Projection", value: 34 },
      { measurement: "Columellar Labial Angle", value: 92 },
      { measurement: "Ala/Alar Length (right)", value: 19 },
      { measurement: "Nasofacial Angle", value: 115 }
    ];

    // Initialize Tabulator table
    new Tabulator("#measurements-table", {
      height: "500px",
      layout: "fitColumns",
      data: data,
      columns: [
        {
          title: "Measurements",
          field: "measurement",
          headerFilter: multiSelectHeaderFilter,
          headerFilterFunc: multiSelectFilterFunc,
        },
        { title: "Value", field: "value" }
      ]
    });
  </script>

</body>
</html>
