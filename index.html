<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>3D Facial Landmark Query Tool</title>

  <!-- Choices.js CSS for multi-selects -->
  <link href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" rel="stylesheet" />

  <style>
    body { font-family: Arial; padding: 20px; }
    .filter-row {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 1rem;
      margin-bottom: 20px;
    }
    label {
      display: flex;
      flex-direction: column;
      font-weight: bold;
    }
    #results-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 16px;
    }
    #results-table th,
    #results-table td {
      border: 1px solid #666;
      padding: 6px;
      text-align: left;
    }
    #results-table th {
      background: #eee;
    }
  </style>
</head>

<body>
  <h2>3D Facial Landmark Query Tool</h2>

  <div class="filter-row">
    <label>Gender
      <select id="genderFilter" multiple>
        <option value="All">All</option>
        <option value="Male">Male</option>
        <option value="Female">Female</option>
        <option value="Prefer Not To Say">Prefer Not To Say</option>
        <option value="Other">Other</option>
      </select>
    </label>

    <label>Ethnicity
      <select id="ethnicityFilter" multiple>
        <option value="All">All</option>
        <option value="White">White</option>
        <option value="Black or African American">Black or African American</option>
        <option value="American Indian or Alaska Native">American Indian or Alaska Native</option>
        <option value="Asian">Asian</option>
        <option value="Native Hawaiian or Other Pacific Islander">Native Hawaiian or Other Pacific Islander</option>
        <option value="Hispanic">Hispanic</option>
      </select>
    </label>

    <label>Facial Surgery
      <select id="surgeryFilter" multiple>
        <option value="Any">Any</option>
        <option value="No Facial Surgery">No Facial Surgery</option>
        <option value="Brow/forehead lift">Brow/forehead lift</option>
        <option value="Ear pinning">Ear pinning</option>
        <option value="Chin, cheek, or jaw reshaping">Chin, cheek, or jaw reshaping</option>
        <option value="Eyelid lift">Eyelid lift</option>
        <option value="Facelift">Facelift</option>
        <option value="Facial implants">Facial implants</option>
        <option value="Hair replacement surgery">Hair replacement surgery</option>
        <option value="Lip augmentation">Lip augmentation</option>
        <option value="Rhinoplasty">Rhinoplasty</option>
        <option value="Other">Other</option>
        <option value="Prefer not to specify">Prefer not to specify</option>
      </select>
    </label>

    <label>Age Start
      <input type="number" id="ageMin" placeholder="Min Age" />
    </label>

    <label>Age End
      <input type="number" id="ageMax" placeholder="Max Age" />
    </label>
  </div>

  <div style="margin-bottom: 16px;">
    <button id="applyBtn">Apply Filters</button>
    <button id="clearBtn">Clear</button>
  </div>

  <h3>Filtered Results</h3>
  <table id="results-table">
    <thead>
      <tr>
        <th>Participant ID</th>
        <th>Gender</th>
        <th>Age</th>
        <th>Ethnicity</th>
        <th>Facial Surgery</th>
      </tr>
    </thead>
    <tbody><!-- rows injected here --></tbody>
  </table>

  <!-- Choices.js -->
  <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>

  <script>
    let originalData = [];

    // initialize Choices.js multi-selects
    const genderChoices    = new Choices('#genderFilter',    { removeItemButton: true });
    const ethnicityChoices = new Choices('#ethnicityFilter', { removeItemButton: true });
    const surgeryChoices   = new Choices('#surgeryFilter',   { removeItemButton: true });

    // helper to render a JS array of rows into our HTML table
    function renderResultsTable(dataArray) {
      const tbody = document.querySelector('#results-table tbody');
      tbody.innerHTML = '';
      dataArray.forEach(r => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${r.participantFileId}</td>
          <td>${r.Gender}</td>
          <td>${r.Age}</td>
          <td>${r.Ethnicity}</td>
          <td>${r.FacialSurgery}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    // load data.json on page load
    fetch('data.json')
      .then(res => res.json())
      .then(data => {
        originalData = data;
        renderResultsTable(originalData);
      })
      .catch(err => console.error('Failed to load data.json:', err));

    // Apply Filters
    document.getElementById('applyBtn').addEventListener('click', () => {
      const selGenders     = genderChoices.getValue(true);
      const selEthnicities = ethnicityChoices.getValue(true);
      const selSurgeries   = surgeryChoices.getValue(true);
      const ageMin         = parseInt(document.getElementById('ageMin').value) || 0;
      const ageMax         = parseInt(document.getElementById('ageMax').value) || Infinity;

      // map dropdown labels â†’ actual codes in data
      const mappedGenders = selGenders
        .filter(v => v !== 'All')
        .map(v => {
          if (v === 'Male')   return 'M';
          if (v === 'Female') return 'F';
          return v; // e.g. "Other", "Prefer Not To Say"
        });

      // treat All/Any as wildcard (empty filter arr)
      const filterGenders     = selGenders.includes('All') ? [] : mappedGenders;
      const filterEthnicities = selEthnicities.includes('All') ? [] : selEthnicities;
      const filterSurgeries   = selSurgeries.includes('Any')  ? [] : selSurgeries;

      // filter the data
      const filtered = originalData.filter(r => {
        const age = parseInt(r.Age) || 0;
        return (
          (filterGenders.length === 0     || filterGenders.includes(r.Gender))        &&
          (filterEthnicities.length === 0 || filterEthnicities.includes(r.Ethnicity)) &&
          (filterSurgeries.length === 0   || filterSurgeries.includes(r.FacialSurgery)) &&
          age >= ageMin && age <= ageMax
        );
      });

      renderResultsTable(filtered);
    });

    // Clear Filters
    document.getElementById('clearBtn').addEventListener('click', () => {
      genderChoices.removeActiveItems();
      ethnicityChoices.removeActiveItems();
      surgeryChoices.removeActiveItems();
      document.getElementById('ageMin').value = '';
      document.getElementById('ageMax').value = '';
      renderResultsTable(originalData);
    });
  </script>
</body>
</html>