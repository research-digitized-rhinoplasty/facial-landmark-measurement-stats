<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>3D Facial Landmark Stats</title>
  <link href="https://unpkg.com/tabulator-tables@5.5.2/dist/css/tabulator.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" rel="stylesheet" />
  <style>
    body { font-family: Arial; padding: 20px; }
    .filter-row {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 1rem;
      margin-bottom: 20px;
    }
    label { display: flex; flex-direction: column; font-weight: bold; }
    #stats-table { margin-top: 20px; }
    .choices__inner { min-width: 160px; }
  </style>
</head>
<body>
  <h2>3D Facial Landmark Query Tool</h2>
  <div class="filter-row">
    <label>Gender
      <select id="genderFilter" multiple>
        <option value="All">All</option>
        <option value="Female">Female</option>
        <option value="Male">Male</option>
        <option value="Prefer not to say">Prefer not to say</option>
        <option value="Other">Other</option>
      </select>
    </label>
    <label>Ethnicity
      <select id="ethnicityFilter" multiple>
        <option value="All">All</option>
        <option value="White">White</option>
        <option value="Black or African American">Black or African American</option>
        <option value="American Indian or Alaska Native">American Indian or Alaska Native</option>
        <option value="Asian">Asian</option>
        <option value="Native Hawaiian or Other Pacific Islander">Native Hawaiian or Other Pacific Islander</option>
        <option value="Hispanic">Hispanic</option>




      </select>
    </label>
    <label>Facial Surgery
      <select id="surgeryFilter" multiple>
        <option value="All">All</option>
        <option value="No Facial Surgery">No Facial Surgery</option>
        <option value="Brow/forehead lift">Brow/forehead lift</option>
        <option value="Ear pinning">Ear pinning</option>
        <option value="Chin, cheek, or jaw reshaping">Chin, cheek, or jaw reshaping</option>
        <option value="Eyelid lift">Eyelid lift</option>
        <option value="Facelift">Facelift</option>
        <option value="Facial implants">Facial implants</option>
        <option value="Hair replacement surgery">Hair replacement surgery</option>
        <option value="Lip augmentation">Lip augmentation</option>
        <option value="Rhinoplasty">Rhinoplasty</option>
        <option value="Other">Other</option>
        <option value="Prefer not to specify">Prefer not to specify</option>
      </select>
    </label>
    <label>Age Start
      <input type="number" id="ageMin" placeholder="Min Age" />
    </label>
    <label>Age End
      <input type="number" id="ageMax" placeholder="Max Age" />
    </label>
  </div>

  <div style="margin-bottom: 16px;">
    <button onclick="applyFilters()">Apply Filters</button>
    <button onclick="clearFilters()">Clear</button>
  </div>

  <div id="stats-table"></div>

  <script src="https://unpkg.com/tabulator-tables@5.5.2/dist/js/tabulator.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
  <script>
  let table;

  // initialize Choices.js
  const genderChoices    = new Choices('#genderFilter',    { removeItemButton: true });
  const ethnicityChoices = new Choices('#ethnicityFilter', { removeItemButton: true });
  const surgeryChoices   = new Choices('#surgeryFilter',   { removeItemButton: true });

  // build the table once
  fetch('data.json')
    .then(res => res.json())
    .then(data => {
      table = new Tabulator("#stats-table", {
        data: data,
        layout: "fitDataStretch",
        pagination: "local",
        paginationSize: 10,
        columns: [
          { title: "Participant ID", field: "participantFileId" },
          { title: "Gender",         field: "Gender" },
          { title: "Age",            field: "Age", sorter: "number" },
          { title: "Ethnicity",      field: "Ethnicity" },
          { title: "Facial Surgery", field: "FacialSurgery" },
          { title: "Landmark",       field: "LandmarkName" },
          { title: "Value",          field: "Value", sorter: "number" },
        ],
      });
    });

  function applyFilters() {
    const selGenders   = genderChoices.getValue(true),
          selEthnic    = ethnicityChoices.getValue(true),
          selSurgeries = surgeryChoices.getValue(true),
          ageMinRaw    = document.getElementById('ageMin').value,
          ageMaxRaw    = document.getElementById('ageMax').value;

    table.clearFilter(true);

    function shouldFilter(arr) { return arr.length && !arr.includes('All'); }

    if (shouldFilter(selGenders))   table.addFilter("Gender",      "in", selGenders);
    if (shouldFilter(selEthnic))    table.addFilter("Ethnicity",   "in", selEthnic);
    if (shouldFilter(selSurgeries)) table.addFilter("FacialSurgery", "in", selSurgeries);

    const ageMin = parseInt(ageMinRaw), ageMax = parseInt(ageMaxRaw);
    if (!isNaN(ageMin)) table.addFilter("Age", ">=", ageMin);
    if (!isNaN(ageMax)) table.addFilter("Age", "<=", ageMax);
  }

  function clearFilters() {
    genderChoices.removeActiveItems();
    ethnicityChoices.removeActiveItems();
    surgeryChoices.removeActiveItems();
    document.getElementById('ageMin').value = '';
    document.getElementById('ageMax').value = '';
    table.clearFilter(true);
  }
</script>

        

</body>
</html>